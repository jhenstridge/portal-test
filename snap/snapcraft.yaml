name: portal-test
version: 1
summary: xdg-desktop-portal test application
description: |
  This test application exercises the features of xdg-desktop-portal

grade: devel
confinement: strict

slots:
  portal-test-dbus:
    interface: dbus
    bus: session
    name: org.gnome.PortalTest

apps:
  portal-test:
    command: desktop-launch $SNAP/bin/portal-test
    environment:
      GTK_USE_PORTAL: 1
    plugs:
      - gsettings
      - x11
      - xdg-desktop-portal
    slots:
      - portal-test-dbus

parts:
  portal-test:
    after:
      - desktop-gtk3
    plugin: nil
    source: .
    build: |
      set -eux
      mkdir build
      meson --prefix=/ . build
      cd build && ninja
    install: |
      set -eux
      export DESTDIR="$SNAPCRAFT_PART_INSTALL"
      cd build && ninja install

    build-packages:
      - meson
      - gcc
      - libgstreamer-plugins-base1.0-dev
      - libgtk-3-dev
